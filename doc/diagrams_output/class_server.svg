<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="103px" preserveAspectRatio="none" style="width:235px;height:103px;background:#000000;" version="1.1" viewBox="0 0 235 103" width="235px" zoomAndPan="magnify"><defs/><g><rect fill="#100115" height="1" style="stroke: #100115; stroke-width: 1.0;" width="1" x="0" y="0"/><rect fill="#33FF02" height="24.0679" style="stroke: #33FF02; stroke-width: 1.0;" width="229" x="5" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="227" x="6" y="20">[From diagrams.puml (line 237) ]</text><text fill="#33FF02" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="0" x="9" y="43.0679"/><text fill="#33FF02" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="159" x="5" y="62.1358">@startuml class_server</text><text fill="#33FF02" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="87" x="5" y="81.2038">!theme plain</text><text fill="#FF0000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="93" x="9" y="100.2717">Syntax Error?</text><!--MD5=[135b9a9b531205f00c702372786d6d24]
@startuml class_server
!theme plain
title Class Diagram - Server Components

class "struct server_stats" as stats {
    +time_t start_time
    +uint32_t total_connections
    +uint32_t active_connections
    +uint32_t tests_completed
    +uint32_t questions_asked
    +uint32_t total_score
    +uint8_t best_score
    +uint32_t best_time
    +char best_player[32]
}

class "struct score_entry" as score {
    +char nick[32]
    +uint8_t score
    +uint32_t time_seconds
}

class QuizDatabase {
    +Question *questions
    +int count
    +int capacity
    - -
    +quiz_load_questions()
    +quiz_get_random_question()
    +quiz_get_question_by_id()
    +quiz_check_answer()
}

class Question {
    +int id
    +char pytanie[512]
    +char odpowiedzi[4][256]
    +int num_odpowiedzi
    +int poprawna
}

class "struct connection" as conn {
    +int fd
    +bool is_listener
    +uint8_t rbuf[8192]
    +size_t rlen, rpos
    +uint8_t wbuf[8192]
    +size_t wlen, wpos
    +enum parse_state state
    +uint16_t tlv_type
    +uint16_t tlv_len
}

class ServerMain {
    +int main(argc, argv)
    +void signal_handler(int)
    - -
    -int listenfd
    -int epollfd
    -QuizDatabase quiz_db
    -score_entry rankings[100]
    -server_stats stats
    -char connection_nicks[2000][32]
}

class ServerUtils {
    +server_handle_login()
    +server_validate_nick()
    +server_is_nick_taken()
    +get_local_ip()
}

class TLVProtocol {
    +tlv_create_*()
    +tlv_parse_*()
    - -
    Types:
    - LOGIN_REQUEST/RESPONSE
    - REQUEST_QUESTION
    - QUESTION_DATA
    - ANSWER_SUBMIT/RESULT
    - SUBMIT_SCORE
    - REQUEST_RANKING
    - RANKING_DATA
    - REQUEST_SERVER_INFO
    - SERVER_INFO_DATA
}

ServerMain - -> QuizDatabase : uses
ServerMain - -> stats : has
ServerMain - -> score : has array
ServerMain - -> conn : manages
ServerMain - -> ServerUtils : calls
ServerMain - -> TLVProtocol : uses
QuizDatabase - -> Question : contains

@enduml

PlantUML version 1.2020.02(Sun Mar 01 11:22:07 CET 2020)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 21.0.9+10-Ubuntu-124.04
Operating System: Linux
Default Encoding: UTF-8
Language: pl
Country: PL
--></g></svg>