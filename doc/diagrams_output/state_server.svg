<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="103px" preserveAspectRatio="none" style="width:235px;height:103px;background:#000000;" version="1.1" viewBox="0 0 235 103" width="235px" zoomAndPan="magnify"><defs/><g><rect fill="#220202" height="1" style="stroke: #220202; stroke-width: 1.0;" width="1" x="0" y="0"/><rect fill="#33FF02" height="24.0679" style="stroke: #33FF02; stroke-width: 1.0;" width="229" x="5" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="227" x="6" y="20">[From diagrams.puml (line 459) ]</text><text fill="#33FF02" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="0" x="9" y="43.0679"/><text fill="#33FF02" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="161" x="5" y="62.1358">@startuml state_server</text><text fill="#33FF02" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="87" x="5" y="81.2038">!theme plain</text><text fill="#FF0000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="93" x="9" y="100.2717">Syntax Error?</text><!--MD5=[8906decb668fffdd778e3a44c0f54e3d]
@startuml state_server
!theme plain
title State Diagram - Server Daemon

[*] - -> Starting

Starting - -> LoadingQuiz : Initialize
LoadingQuiz - -> Daemonizing : Questions loaded
LoadingQuiz - -> Error : Load failed

Daemonizing - -> Running : daemon_init() OK
Daemonizing - -> Error : daemon_init() failed

state Running {
    [*] - -> EpollWait
    
    EpollWait - -> AcceptConnection : New connection
    EpollWait - -> HandleMessage : Data ready
    EpollWait - -> CheckShutdown : Timeout
    
    AcceptConnection - -> UpdateStats : Connection accepted
    UpdateStats - -> EpollWait
    
    HandleMessage - -> ParseTLV
    ParseTLV - -> ProcessLogin : LOGIN_REQUEST
    ParseTLV - -> ProcessQuestion : REQUEST_QUESTION
    ParseTLV - -> ProcessAnswer : ANSWER_SUBMIT
    ParseTLV - -> ProcessScore : SUBMIT_SCORE
    ParseTLV - -> ProcessRanking : REQUEST_RANKING
    ParseTLV - -> ProcessServerInfo : REQUEST_SERVER_INFO
    
    ProcessLogin - -> SendResponse
    ProcessQuestion - -> SendResponse
    ProcessAnswer - -> SendResponse
    ProcessScore - -> UpdateStatistics
    UpdateStatistics - -> SaveRanking
    SaveRanking - -> EpollWait
    ProcessRanking - -> SendResponse
    ProcessServerInfo - -> SendResponse
    
    SendResponse - -> EpollWait
    
    CheckShutdown - -> EpollWait : Continue
    CheckShutdown - -> Cleanup : shutdown_requested
}

Running - -> Cleanup : SIGTERM/SIGINT

Cleanup - -> [*] : closelog(), close sockets

Error - -> [*]

note right of Running
  Event loop with epoll:
  - EPOLLIN: data ready
  - EPOLLERR: error
  - EPOLLHUP: hangup
end note

@enduml

PlantUML version 1.2020.02(Sun Mar 01 11:22:07 CET 2020)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 21.0.9+10-Ubuntu-124.04
Operating System: Linux
Default Encoding: UTF-8
Language: pl
Country: PL
--></g></svg>